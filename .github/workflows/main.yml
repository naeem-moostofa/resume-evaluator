name: Keep Supabase Awake

on:
  schedule:
    # Runs once per day at 13:00 UTC (08:00 Toronto time in EST; 09:00 in EDT)
    - cron: '0 13 * * *'
  workflow_dispatch: {}  # allow manual runs

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Supabase RPC
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
        run: |
          set -e
          URL="$SUPABASE_URL/rest/v1/rpc/ping"
          CODE=$(curl -s -o /dev/null -w '%{http_code}' \
            -H "apikey: $SUPABASE_ANON_KEY" \
            -H "Authorization: Bearer $SUPABASE_ANON_KEY" \
            -H "Content-Type: application/json" \
            -d '{}' \
            "$URL")
          echo "HTTP $CODE"
          # Fail workflow on non-2xx/3xx
          [ "$CODE" -ge 200 ] && [ "$CODE" -lt 400 ]
